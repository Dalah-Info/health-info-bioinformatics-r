---
title: 'اليوم الثاني: '
output:
  html_document:
    lang: ar
    css: ../sc/style.css
    df_print: paged
  pdf_document: default
editor_options:
  markdown:
    wrap: sentence
---

--

# ماهي ملفات MAF؟

<br><br>

ملف **MAF** هو اختصار لـ **Mutation Annotation Format**، وهو صيغة ملفات قياسية تُستخدم بشكل واسع في المعلوماتية الحيوية (Bioinformatics) لتخزين وتمثيل بيانات الطفرات الجينية المكتشفة في الدراسات الجينومية، خصوصًا في مجال أبحاث السرطان.

يُعتبر ملف الـ MAF تنسيقًا جدوليًا (جدول نصي مفصول بفواصل أو تبويبات) يضم معلومات وصفية عن كل طفرة جينية، بحيث يتيح للباحثين تبادل البيانات وتحليلها بطريقة موحّدة ومنظمة.

**🟠 المحتويات الأساسية لملف MAF:**

▪️ **Gene Symbol (رمز الجين)**: اسم الجين الذي حدثت فيه الطفرة.

▪️ **Chromosome (الكروموسوم)**: موقع الطفرة على الكروموسوم.

▪️ **Start/End Position (موضع البداية والنهاية):** الموقع الجينومي للطفرات.

▪️ **Variant Classification (تصنيف الطفرة):** يحدد نوع الطفرة (مثل: Silent، Missense، Nonsense، Frame-shift...).

▪️ **Variant Type (نوع التغير):** مثل SNP (تعدد أشكال النوكليوتيدات المفردة) أو Insertion أو Deletion.

▪️ **Reference & Tumor Allele (الأليل المرجعي وأليل الورم):** مقارنة بين التسلسل المرجعي والتغير المرصود.

▪️ **Sample Information (معلومات العينة):** مثل المريض، نوع النسيج (ورمي أو طبيعي).

ننطلق الآن للعمل على هذا الملف!

<br><br>

------------------------------------------------------------------------

## 1. سنقوم بتهيئة بيئة العمل، ثم نحمّل الحزم البرمجية التي سنحتاج إليها أثناء هذه الورشة.

<br><br>

```{r Setting up the environment}

library(maftools)
library(dplyr)
library(skimr)
library(tidyverse)
library(ggplot2)
```
<br><br>

## 2. نقوم بقراءة ملف البيانات الوصفية الذي تم حفظه في اليوم الأول

<br><br>


``` {r load metadata}

url <- "https://raw.githubusercontent.com/Dalah-Info/health-info-bioinformatics-r/refs/heads/main/Day1/Breast_tumor_metadata_cleaned.csv"
Breast_tumor_metadata = read.csv(url)

```

<br><br>


## 3. نقوم بقراءة ملف الطفرات الجينية: MFA

<br><br>


``` {r load maf file}

url2 <- "https://github.com/Dalah-Info/health-info-bioinformatics-r/raw/refs/heads/main/maf_file/filtered_maf_breast_only_maftools.maf.gz"
maf_file = read.maf(maf = url2)

```
<br><br>

## 4. نستكشف شكل ملف MAF والبيانات المسجلة فيه

<br><br>


``` {r explore maf file}

head(maf_file@data) #البيانات الوصفية نجدها في هذه الخانة


```

نقوم باستخدام أداة **skimr** لتقرأ لنا الملف كاملا

``` {r skim maf file}

skim(maf_file@data) 

```

<br><br>

## 5. دمج ملف البيانات الوصفية والاكلينيكية مع ملف MAF

<br><br>

**لماذا؟ 🔴**

عادة ما يأتي ملف MAF منفصلا عن الملف الوصفي، ونحتاج لدمجهما معًا حتى نتمكن من تحليل الطفرات وربطها بهذه البيانات.

**كيف؟ 🔴**

نحتاج إلى عمود واحد مشترك بين الملفين، عادة يكون رمز العينة


**أين نجد رمز العينة؟ 🔴**

في ملف MAF، هناك نمطان من ترميز العينات (Sample Barcoding) يجب الانتباه لهما:

1) نمط TCGA

2) نمط UUID

اختر النمط الموجود في ملف الـ MAF وأيضًا في البيانات الوصفية (Metadata)، حتى تتمكن من ربط الجدولين باستخدام هذا العمود.


``` {r patient ID in MAF file}

head(unique(maf_file@data$Tumor_Sample_UUID), 5) #لايوجد مدخلات

head(unique(maf_file@data$Tumor_Sample_Barcode),5)

```
<br><br>

سوف نختار رمز TCGA لأن UUID غير موجود في ملف الـ MAF.

**🔴 رمز العينة في ملف MAF:**

*TCGA-OL-A66K-01A-11D-A29N-09* هو رمز كامل للعينة (sample/aliquot barcode).
ويتكوّن من:

▪️ TCGA → المشروع (Project)

▪️ OL → موقع مصدر النسيج (Tissue Source Site - TSS)

▪️ A66K → معرّف المشارك (المريض) (Participant/Patient ID)

▪️ 01A → نوع العينة + القارورة (01 = ورم أولي "Primary tumor" ؛ A = قارورة)

▪️ 11D → الجزء + المحلل الحيوي (11 = جزء، D = DNA)

▪️ A29N → الصفيحة (Plate)

▪️ 09 → المركز (Center)


هل توجد هذه البيانات في ملف البيانات الوصفية؟ لنتحقق من ذلك

<br><br>

``` {r explore patient ID in metadata}

head(unique(Breast_tumor_metadata$bcr_patient_barcode),5)

```
<br><br>

**🔴رمز العينة في البيانات الوصفية (Metadata):**

لدينا فقط رمز المريض (Patient Barcode) مثل:
*TCGA-EW-A6S9*، وهو يتكون فقط من أول 12 حرفًا من رمز الـ TCGA الكامل الموجود في ملف MAF.

✅ إذن القاعدة هي:
**رمز المريض في الملف الوصفي = أول 12 حرف من رمز العينة في ملف MAF**.

<br><br>

```{r get unique patient ID}

#نستخلص ترميزات المرضى الموجودة في ملف ماف
maf_patuent_ids <- unique(as.character(maf_file@data$Tumor_Sample_Barcode))

#نستقطع أول 12 حرف منها، وهي عبارة عن رمز المريض
maf_patient_ids <- substr(maf_patuent_ids, 1, 12)

# نقوم بتصفية ملف البيانات الوصيفة، حتى نحذف منه أي مريض لا توجد لدينا معلوماته في ملف ماف
matched_clinical_data <- Breast_tumor_metadata[Breast_tumor_metadata$bcr_patient_barcode %in% maf_patient_ids, ]


#ننشئ عمود جديد في ملف البيانات الوصفية، يحمل نفس اسم العمود الموجود في ملف ماف (وترميزه أيضا)
matched_clinical_data$Tumor_Sample_Barcode <- matched_clinical_data$bcr_patient_barcode

#وبالتالي أصبح لدينا عمود مشترك بين الملفين ويمكننا الآن دمجهما في ملف واحد!

```

<br><br>

**✅ نستطيع الآن إنشاء ملف MAF مكتمل، يحتوي على البيانات الوصفية الإكلينيكية:**

<br><br>


```{r integrate maf and metadata file}

maf_file <- read.maf(maf = url2, clinicalData = matched_clinical_data, verbose = F)

```


