---
title: "اليوم الثاني: تحليل البيانات الجينية وربطها بالبيانات الإكلينيكية"
lang: ar
output:
  html_document:
    css: ../sc/style.css
    df_print: paged
  pdf_document: default
editor_options:
  markdown:
    wrap: sentence
---


# ماهي ملفات MAF؟

<br><br>

ملف **MAF** هو اختصار لـ **Mutation Annotation Format**، وهو صيغة ملفات قياسية تُستخدم بشكل واسع في المعلوماتية الحيوية (Bioinformatics) لتخزين وتمثيل بيانات الطفرات الجينية المكتشفة في الدراسات الجينومية، خصوصًا في مجال أبحاث السرطان.

يُعتبر ملف الـ MAF تنسيقًا جدوليًا (جدول نصي مفصول بفواصل أو تبويبات) يضم معلومات وصفية عن كل طفرة جينية، بحيث يتيح للباحثين تبادل البيانات وتحليلها بطريقة موحّدة ومنظمة.

**🟠 المحتويات الأساسية لملف MAF:**

▪️ **Gene Symbol (رمز الجين)**: اسم الجين الذي حدثت فيه الطفرة.

▪️ **Chromosome (الكروموسوم)**: موقع الطفرة على الكروموسوم.

▪️ **Start/End Position (موضع البداية والنهاية):** الموقع الجينومي للطفرات.

▪️ **Variant Classification (تصنيف الطفرة):** يحدد نوع الطفرة (مثل: Silent، Missense، Nonsense، Frame-shift...).

▪️ **Variant Type (نوع التغير):** مثل SNP (تعدد أشكال النوكليوتيدات المفردة) أو Insertion أو Deletion.

▪️ **Reference & Tumor Allele (الأليل المرجعي وأليل الورم):** مقارنة بين التسلسل المرجعي والتغير المرصود.

▪️ **Sample Information (معلومات العينة):** مثل المريض، نوع النسيج (ورمي أو طبيعي).

ننطلق الآن للعمل على هذا الملف!

<br><br>

___

## 1. سنقوم بتهيئة بيئة العمل، ثم نحمّل الحزم البرمجية التي سنحتاج إليها أثناء هذه الورشة.

<br><br>

```{r Setting up the environment}

library(maftools)
library(dplyr)
library(skimr)
library(tidyverse)
library(ggplot2)
library(data.table)
library(ggrepel)


```

<br><br>

## 2. نقوم بقراءة ملف البيانات الوصفية الذي تم حفظه في اليوم الأول

<br><br>

```{r load metadata}

url <- "https://raw.githubusercontent.com/Dalah-Info/health-info-bioinformatics-r/refs/heads/main/Day1/Breast_tumor_metadata_cleaned.csv"
Breast_tumor_metadata = read.csv(url,  row.names = NULL)

```

<br><br>

## 3. نقوم بقراءة ملف الطفرات الجينية: MFA

<br><br>

```{r load maf file}

url2 <- "https://github.com/Dalah-Info/health-info-bioinformatics-r/raw/refs/heads/main/maf_file/filtered_maf_breast_only_maftools.maf.gz"
maf_file = read.maf(maf = url2)

```

<br><br>

## 4. نستكشف شكل ملف MAF والبيانات المسجلة فيه

```{r explore maf file}

head(maf_file@data) #البيانات الوصفية للحينات نجدها في هذه الخانة


```

نقوم باستخدام أداة **skimr** لتقرأ لنا الملف الوصفي كاملا

```{r skim maf file}

skim(maf_file@data) 

```

<br><br>

## 5. دمج ملف البيانات الوصفية والاكلينيكية مع ملف MAF

<br><br>

**لماذا؟ 🔴**

عادة ما يأتي ملف MAF منفصلا عن الملف الوصفي، ونحتاج لدمجهما معًا حتى نتمكن من تحليل الطفرات وربطها بهذه البيانات.

**كيف؟ 🔴**

نحتاج إلى عمود واحد مشترك بين الملفين، عادة يكون رمز العينة

**أين نجد رمز العينة؟ 🔴**

في ملف MAF، هناك نمطان من ترميز العينات (Sample Barcoding) يجب الانتباه لهما:

1)  نمط TCGA

2)  نمط UUID

اختر النمط الموجود في ملف الـ MAF وأيضًا في البيانات الوصفية (Metadata)، حتى تتمكن من ربط الجدولين باستخدام هذا العمود.

```{r patient ID in MAF file}

head(unique(maf_file@data$Tumor_Sample_UUID), 5) #لايوجد مدخلات

head(unique(maf_file@data$Tumor_Sample_Barcode),5)

```

<br><br>

سوف نختار رمز TCGA لأن UUID غير موجود في ملف الـ MAF.

**🔴 رمز العينة في ملف MAF:**

*TCGA-OL-A66K-01A-11D-A29N-09* هو رمز كامل للعينة (sample/aliquot barcode).
ويتكوّن من:

▪️ TCGA → المشروع (Project)

▪️ OL → موقع مصدر النسيج (Tissue Source Site - TSS)

▪️ A66K → معرّف المشارك (المريض) (Participant/Patient ID)

▪️ 01A → نوع العينة + القارورة (01 = ورم أولي "Primary tumor" ؛ A = قارورة)

▪️ 11D → الجزء + المحلل الحيوي (11 = جزء، D = DNA)

▪️ A29N → الصفيحة (Plate)

▪️ 09 → المركز (Center)

هل توجد هذه البيانات في ملف البيانات الوصفية؟ لنتحقق من ذلك

<br><br>

```{r explore patient ID in metadata}

head(unique(Breast_tumor_metadata$bcr_patient_barcode),5)

```

<br><br>

**🔴رمز العينة في البيانات الوصفية (Metadata):**

لدينا فقط رمز المريض (Patient Barcode) مثل: *TCGA-EW-A6S9*، وهو يتكون فقط من أول 12 حرفًا من رمز الـ TCGA الكامل الموجود في ملف MAF.

✅ إذن القاعدة هي: **رمز المريض في الملف الوصفي = أول 12 حرف من رمز العينة في ملف MAF**.

<br><br>

```{r get unique patient ID}

#ننشئ ملف بيانات يحتوي على الرمز الطويل والقصير للمريض، لنستخدمه لاحقا للدمج.

id_map <- data.frame(
  short_id = substr(maf_file@data$Tumor_Sample_Barcode, 1, 12),             # معرّف المريض (12 حرف)
  Tumor_Sample_Barcode = as.character(maf_file@data$Tumor_Sample_Barcode),  # المعرّف الكامل للعينة
  stringsAsFactors = FALSE
)

#إزالة التكرار على مستوى المريض 
id_map <- id_map[!duplicated(id_map$short_id), ]


matched_clinical_data <- merge(
  x = Breast_tumor_metadata,     # البيانات السريرية
  y = id_map,                    # خريطة المعرّفات من ملف الـ MAF
  by.x = "bcr_patient_barcode",  # اسم عمود المريض في البيانات السريرية
  by.y = "short_id",             # اسم عمود المريض (12 حرف) في الخريطة
  all.x = FALSE                  # احتفظ فقط بالمرضى الموجودين في الـ MAF
)


## الآن: matched_clinical_data يحوي فقط المرضى المطابقين، وبداخله عمود Tumor_Sample_Barcode المشترك.


```

<br><br>

**✅ نستطيع الآن إنشاء ملف MAF مكتمل، يحتوي على البيانات الوصفية الإكلينيكية:**

<br><br>

```{r integrate maf and metadata file}

maf_file <- read.maf(maf = url2, clinicalData = matched_clinical_data, verbose = F)

```


___

## 5. ننطلق الآن لاستكشاف الطفرات الجينية المُسجلة في ملف MAF!

<br><br>

### 5.1 ملخص الطفرات المٌسجلة في ملف MAF لكل مريض.🩺

```{r get sample summary}

getSampleSummary(maf_file)

```

<br><br>

### 5.2 ملخص الطفرات المٌسجلة في ملف MAF لكل جين.🧬

```{r get gene summary}

getGeneSummary(maf_file)

```

<br><br>

### 5.3 رسم ملخص شامل لمعظم البيانات 

```{r plot maf summary}
# رسم ملخص شامل: عدد الطفرات، نسب الأنواع المختلفة، إحصائيات عامة

plotmafSummary(maf = maf_file, rmOutlier = TRUE, addStat = 'median', dashboard = TRUE, titvRaw = FALSE)

```

<br><br>

### 5.4 رسم Oncoplot لأكثر 10 جينات تعرضاً للطفرات

تعبر رسمة الـ **oncoplot** واحدة من أشهر الرسومات المرتبطة بدراسة الطفرات
ساعد الباحث على رؤية الأنماط الجينية (mutation patterns) وتحديد الجينات الحرجة في تطور السرطان.

```{r plot oncoplot of top 10 genes}

# oncoplot يعرض الجينات الأعلى تكراراً في عينات المرضى

oncoplot(maf = maf_file, top = 10)

```
<br><br>

### 5.5 🔄 تحليل Transition / Transversion (Ti/Tv)

**🔹 Transition (Ti):**
هي استبدال بيريميدين ↔ بيريميدين (C↔T) أو بيورين ↔ بيورين (A↔G).

→ نوع "محافظ" أكثر (conservative)، ويحدث بشكل شائع.

**🔹 Transversion (Tv):**
هي استبدال بيريميدين ↔ بيورين (C↔A, C↔G, T↔A, T↔G).

→ أقل شيوعًا، لكنها قد تكون مؤثرة أكثر على البروتين.

⚖️ النسبة Ti/Tv تُستخدم كمقياس في دراسات الطفرات، وغالبًا تكون ≈ 2–3 في معظم الأورام والـ exomes (لأن Ti تحدث أكثر).

**🔹 الفائدة من تحليل Ti/Tv:**

تقييم جودة بيانات التسلسل (NGS):
نسبة Ti/Tv المنطقية تدل أن البيانات سليمة وغير ملوثة بأخطاء تسلسل.

تحديد البصمات الطفرية (Mutational Signatures):
بعض السرطانات أو عوامل البيئة (تدخين، أشعة UV، إلخ) تُظهر أنماط Ti/Tv مختلفة.

فهم الآليات البيولوجية للطفرات:
مثلًا:

▪️ UV → يسبب C>T transitions.

▪️ التدخين → يزيد C>A transversions.


```{r plot titv summary }

# حساب أنواع الاستبدال (Ti/Tv) في الطفرات

 laml.titv = titv(maf = maf_file, plot = FALSE, useSyn = TRUE)

 # رسم ملخص Ti/Tv
plotTiTv(res = laml.titv)

```

✅ الخلاصة:
التحليل يوضح أن الـ C>T transition هو الأكثر شيوعًا، وأن النسبة الإجمالية للطفرات تميل لصالح الـ Transitions (Ti) مقارنةً بالـ Transversions (Tv)، وهو نمط متوقع ويدعم أن البيانات ذات جودة عالية.

<br><br>


### 5.6 رسم توزيع الأليلات: Variant Allele Frequency (VAF)

**🔹 ما هو الـ VAF؟**

VAF = نسبة القراءات (Reads) التي تحمل الطفرة ÷ إجمالي القراءات المغطية لهذا الموضع.
مثال: لو عندنا 100 قراءة على موقع جيني، و40 منها فيها طفرة → VAF = 0.4 (40%).

يُستخدم كمقياس لاحتمالية أن تكون الطفرة:

طفرة جسدية (somatic mutation).

طفرة من السلالة التناسلية  (germline mutation).

أو ناتجة عن heterogeneity (اختلاط خلايا مختلفة داخل الورم).

**🔹 ماذا نستنتج من هذا النوع من التحليل؟**

الطفرات ذات VAF مرتفع (~0.5 أو أعلى):

قد تكون طفرة مؤسِّسة (founder mutation) في الورم.

أو أحيانًا طفرة germline (موروثة).

الطفرات ذات VAF منخفض (<0.3 تقريبًا):

غالبًا subclonal mutations → موجودة في نسبة من الخلايا الورمية فقط.

تعكس تغايرية الورم (tumor heterogeneity).

توزيع VAF يختلف بين الجينات:

مثلًا: TP53 غالبًا يظهر بطفرات عالية التكرار وVAF متوسط–عالٍ، مما يدل على أنه جين أساسي في نشأة الورم (driver gene).

بينما جينات مثل TTN, MUC16 غالبًا تُظهر VAF أكثر تنوعًا لأنها جينات كبيرة الحجم وتراكم فيها الطفرات (passenger mutations).


```{r Variant Allele Frequencies}

plotVaf(maf = maf_file, vafCol = NULL, top = 20)


```


<br><br>

### 5.7 ⚔️ تحليل العلاقة بين الجينات، هل تحدث الطفرتين معا؟

نحاول فهم علاقة الطفرات ببعضها، هل هي طفرات تعاونية (تظهر عادة معا)، أم بديلة (واحد منها يكفي لخلق الأثر.)

وهذا يساعد على فهم المسارات الجزيئية في السرطان وربما اقتراح أهداف علاجية (إذا كان مسار محدد هو المسيطر).

```{r somatic Interactions}
# يكشف عن علاقة التعايش أو التنافي بين الطفرات في الجينات

somaticInteractions(maf = maf_file, top = 25, pvalue = c(0.05, 0.1))

```


**🔹 ماذا نستنتج من الشكل؟**

TP53 ↔ PIK3CA:
العلاقة بنية (mutually exclusive) → عادةً لا يتحوران معًا، قد يشير أن كل منهما يكفي لدفع الورم.

PIK3CA ↔ GATA3 / MAP3K1:
العلاقة موجبة (co-occurrence) → الطفرات تميل للظهور معًا.

معظم الجينات الأخرى (MUC16, TTN, SYNE1, FLG… إلخ):
تظهر ارتباطات موجبة قوية جدًا (* أخضر داكن)، مما قد يعكس كونها "Passenger mutations" متجمعة.

تفسير بيولوجي:

Co-occurrence: يوحي بأن الجينات تعمل في مسارات مختلفة لكن تكاملية، والورم يستفيد من تحويرهما معًا.

Mutual exclusivity: يوحي بأن الجينات تعمل في نفس المسار (pathway redundancy)، وطفرات أحدهما تكفي لتعطيل المسار.


<br><br>

## 6. تحليل تأثير الطفرات على الحياة (هل تؤثر الطفرات في هذا الجين على مدة العيش؟)
<br><br>

لإجراء هذا التحليل نحتاج معلومتين رئيسيتين:
1) حالة المريض: حي أو متوفى. ويجب كتابتها بطريقة 0 أو 1، حيث أن 0 ترمز للحياة و 1 ترمز للوفاة.
2) يجب أن يكون لدينا عدد الأيام حتى آخر زيارة للمريض أو حتى وقت الوفاة.


### 6.1 نتأكد بأن البيانات تستوفي الشكل المطلوب لتطبيق التحليل

```{r data engineering - survival analysis}

# 1) تحويل حالة الوفاة إلى 0/1
maf_file@clinical.data$vital_status <- ifelse(maf_file@clinical.data$vital_status %in% c("Dead", "1"), 1, 0)

# 2) تحويل الأيام إلى قيم رقمية
num <- function(x) suppressWarnings(as.numeric(as.character(x)))
dtd  <- num(maf_file@clinical.data$days_to_death)
dtlf <- num(maf_file@clinical.data$days_to_last_followup)

# 3) حساب زمن البقاء (OS.time): وقت الوفاة أو آخر متابعة

maf_file@clinical.data$OS.time <- ifelse(!is.na(dtd), dtd, dtlf)

# تأكيد أن القيم رقمية

maf_file@clinical.data[,vital_status :=  as.numeric(vital_status)]
maf_file@clinical.data[,OS.time :=  as.numeric(OS.time)]


```

<br><br>

### 6.2 🧬نقوم بتحليل تأثير الطفرات على الحياة في جين واحد فقط

```{r Survival analysis}

# 4) تحليل البقاء لجين محدد (مثال: NEB)

mafSurvival(maf = maf_file, genes = 'NEB', time = 'OS.time', Status = 'vital_status', isTCGA = FALSE)


```

<br><br>

### 6.3 🧬 تحليل تأثير الطفرات على الحياة باستخدام مجموعات من الجينات

ربما لا يكون لجين واحد تأثير كبير، ولكن في بعض الحالا وجود طفرتين في جينين مختلفين في وقت واحد يسبب إما وفاة أسرع أو يساعد على العيش لفترة أطول، ولاكتشاف ذلك نقوم بإجراء هذا التحليل.


```{r survival analysis - gene sets}

# 5) تحليل البقاء لأكثر من جين

# البحث عن مجموعات جينات (مثلاً 2 جين) من بين أعلى 100 جين لتوقع البقاء

prog_geneset = survGroup(maf = maf_file, top = 100, geneSetSize = 2, time = "OS.time", Status = "vital_status", verbose = TRUE)

 #عرض أول 5 صفوف من النتيجة
head(prog_geneset, 5)

```

<br><br>

### 6.4 🪢 رسم نتائج التحليل لمجموعة من الجينات


```{r plot survaival analysis of two genes}

# مثال: تحليل البقاء لجيني MUC17 و BRCA2

mafSurvGroup(maf = maf_file, geneSet = c("MUC17", "BRCA2"), time = "OS.time", Status = "vital_status")


```

<br><br>

___

## 7. ربط الطفرات الجينية بالبيانات السريرية

### 7.1 👩‍⚕️ هل توجد جينات تترافق طفراتها مع جنس المريض؟

#### 7.1.1 📈 نتأكد من أن البيانات مناسبة لإجراء التحليل الإحصائي.

```{r Clinical enrichment analysis - gender}

# توزيع العينات حسب الجنس

table_gender <- table(maf_file@clinical.data$gender) 

barplot(table_gender,
        main = "Gender distribution of breast tumor cases",
        ylab = "Count",
        col = c("pink", "lightblue"))

```

نستنتج أن المقارنة هنا لن تنجح إحصائيا بسبب الاختلاف الكبير بعدد العينات بين الذكور والإناث.

<br><br>

___

### 7.2 ☢️ هل توجد جينات تترافق طفراتها مع حالة العلاج الإشعاعي للمريض؟

#### 7.2.1 نتأكد من أن البيانات مناسبة لإجراء التحليل الإحصائي.


```{r Check radiation therapy}

# ملخص حالة العلاج الإشعاعي من البيانات السريرية

table_radiation <- table(maf_file@clinical.data$radiation_therapy)

#رسم توزيع الحالات

barplot(table_radiation,
        main = "Radiation therapy status",
        ylab = "Count",
        col = c("orange", "gray70", "gray90", "lightblue", "tomato"),
        las = 2)  # rotate labels for readability

```

#### 7.2.2 نحتاج لإزالة البيانات الغير مُسجلة أو المفقودة.

``` {r engineer radiation therapy data}

# توحيد القيم إلى YES/NO فقط، وما عدا ذلك يحوّل إلى NA
maf_file@clinical.data$radiation_therapy <- ifelse(
  maf_file@clinical.data$radiation_therapy %in% c("NO", "YES"),
  maf_file@clinical.data$radiation_therapy,
  NA
)

# إعادة حساب الجدول بعد التنظيف
table_radiation <- table(maf_file@clinical.data$radiation_therapy)

# رسم التوزيع بعد التنظيف (YES/NO فقط)
barplot(table_radiation,
        main = "Radiation therapy status",
        ylab = "Count",
        col = c( "lightblue", "tomato"),
        las = 2)  # rotate labels for readability

```

#### 7.2.3 📈 نقوم الآن بإجراء الاختبار الإحصائي.

```{r Clinical enrichment analysis - radiation_therapy}

#Clinical feature enrichment using maftools

radiation_therapy.ce = clinicalEnrichment(maf = maf_file, clinicalFeature = 'radiation_therapy')

head(radiation_therapy.ce)

# إبراز المقارنات ذات الدلالة الإحصائية (p < 0.05)
radiation_therapy.ce$pairwise_comparision[fdr < 0.05]



```

<br><br>

#### 7.2.4 📈 استخراج الجينات المرتبط بالعلاج الاشعاعي بطريقة أكثر صحة إحصائيا

```{r plot sig genes}

#Extract pairwise comparisons table
df <- radiation_therapy.ce$pairwise_comparision

# extract numerator/denominator and compute relative frequencies

df[, c("mut1", "total1") := tstrsplit(n_mutated_Feature1, " of ", fixed=TRUE)]
df[, c("mut2", "total2") := tstrsplit(n_mutated_Feature2, " of ", fixed=TRUE)]

# Convert to numeric
df[, `:=`(mut1 = as.numeric(mut1),
          total1 = as.numeric(total1),
          mut2 = as.numeric(mut2),
          total2 = as.numeric(total2))]

# Compute relative values
df[, rel1 := mut1 / total1]
df[, rel2 := mut2 / total2]

df <- df[order(-rel1, -rel2)]
df <- df[fdr < 0.01]

# Take top 10 significant genes
top10 <- df[order(fdr)][1:10]


# Reshape to long format for ggplot
plotdf <- melt(top10,
               id.vars = "Hugo_Symbol",
               measure.vars = c("rel1", "rel2"),
               variable.name = "Feature",
               value.name = "Relative")

# Make Feature labels clearer
plotdf[, Feature := fifelse(Feature == "rel1", "Feature_1 (YES)", "Feature_2 (NO)")]

# Plot
ggplot(plotdf, aes(x = reorder(Hugo_Symbol, Relative), y = Relative, fill = Feature)) +
  geom_bar(stat = "identity", position = position_dodge()) +
  coord_flip() +
  labs(x = "Gene", y = "Relative mutated fraction",
       title = "Top 10 significant genes by relative mutation frequency") +
  theme_minimal()


```

<br><br>

#### 7.2.5 🎯 Effect Size vs Significance


```{r plot }
# فرق النسبة بين المجموعتين كحجم تأثير مبسّط


top10[, diff_rel := rel1 - rel2]

ggplot(top10, aes(x = diff_rel, y = -log10(fdr), label = Hugo_Symbol)) +
  geom_point() +
  geom_text_repel() +
  theme_minimal() +
  labs(x = "Difference in relative mutation (Feature1 - Feature2)",
       y = "-log10(FDR)",
       title = "Effect size vs significance")
```

<br><br>

___

## 8. استخراج البيانات الجينية والدوائية

### 8.1 💊 البحث عن الأدوية المناسبة لكل جين في ملف MAF

```{r drug-gene interactions}
# البحث عن تفاعلات دواء-جين للوحة الجينات المستخلصة من الـ MAF
dgi = drugInteractions(maf = maf_file, fontSize = 0.75)

```


### 8.2 ماذا عن الأدوية المُسجلة لجين واحد فقط؟


```{r DGI - specific gene}

# استرجاع التفاعلات الدوائية لجين محدد
dnmt3a.dgi = drugInteractions(genes = "TP53", drugs = TRUE)

# عرض أعمدة مختارة مفيدة للتقارير
dnmt3a.dgi[,.(Gene, interaction_types, drug_name, drug_claim_name)]

```

<br><br>

___

## 9. استخراج مسارات أيضية مُتأثرة بالطفرات


```{r Oncogenic Signaling Pathways}

pws = pathways(maf = maf_file, plotType = 'bar')

pws

```

<br><br>

___


## 10. 🧩  دراسة تنوع الطفرات داخل الأورام

**🔹 ما الفكرة؟**

الأورام ليست كتلة خلوية متجانسة، بل غالبًا تتكون من عدة مستعمرات (clones) من الخلايا، كل مستعمرة تحمل مجموعة من الطفرات المميزة.

الطفرات التي تحدث في بداية نشأة الورم (founder mutations) تظهر بنسبة عالية (VAF مرتفع).

الطفرات التي تحدث لاحقًا أثناء تطور الورم تظهر في subclones (VAF أقل).

📊 لذلك، توزيع VAF يمكن تقسيمه إلى clusters → كل cluster يمثل مجموعة من الطفرات المرتبطة بمستعمرة معينة.





```{r Tumor heterogeneity and MATH scores}

# mclust مطلوبة لتجميع التوزيعات (Gaussian mixture models)
library("mclust")

```

نخار عينة واحدة فقط لندرس كيف تتنوع الطفرات في هذه العينة

```{r tumor}

hetero_breast_tumor = inferHeterogeneity(maf = maf_file, tsb = 'TCGA-3C-AAAU-01A-11D-A41F-09')

print(hetero_breast_tumor$clusterMeans)

#Visualizing results
plotClusters(clusters = hetero_breast_tumor)


```

**🔹 الاستنتاج:**

الورم في هذه العينة متغاير بشدة (MATH ~47).

هناك على الأقل 3 مجموعات/مستعمرات مختلفة من الخلايا:

طفرات subclonal (VAF منخفض).

طفرات clonal ثانوية (VAF متوسط).

طفرات مؤسِّسة أو جيرملين (VAF عالي).

**🔬 هذا مهم لأنه:**

يعكس تطور الورم (tumor evolution).

يفسر لماذا بعض الأورام مقاومة للعلاج (لأن مستعمرات فرعية قد تنجو).

يساعد في تحديد العلاجات المستهدفة بناءً على الطفرات المشتركة بين جميع الخلايا الورمية (clonal mutations).


___
<br><br>

## 11. Mutation Signature 

كل ورم يترك خلفه بصمة (Signature) خاصة به، عبارة عن نمط مميز من الطفرات (substitution types).
هذه البصمات مرتبطة غالبًا بآليات بيولوجية محددة (مثل: APOBEC, UV, التدخين, MMR deficiency … إلخ).
📊 التحليل يتم عبر:

بناء مصفوفة الطفرات (trinucleotide mutation matrix).

استخدام NMF (non-negative matrix factorization) لاستخراج عدد n من البصمات.

مقارنة البصمات المستخرجة مع قاعدة بيانات COSMIC Signatures لمعرفة السبب المحتمل للطفرات.

يساعدنا في عمل ذلك حزمة NMF والتي ستقوم بحساب عدد البصمات المتوقعة.


```{r signature}

library('NMF')
library("BSgenome.Hsapiens.UCSC.hg19", quietly = TRUE)
```

<br><br>


### 11.1 Trinucleotides 

**🔹ما معنى Trinucleotides analysis؟**

عندما نحلل الطفرات، لا يكفي فقط أن نعرف أن الطفرة مثلًا C>T، لأن سياق القاعدة قبلها وبعدها (±1 base) مهم جدًا.

مثال: الطفرة C>T قد تحدث في تسلسل TCA → TTA أو في GCG → GTG.

هذه السياقات الثلاثية (trinucleotides) تساعدنا على تحديد بصمة الطفرة (Mutational signature).

دالة trinucleotideMatrix() في maftools:

تنشئ مصفوفة تصنيف الطفرات إلى 96 نوعًا مختلفًا (6 أنواع بدائل أساسية × 16 سياق ثلاثي).

```{r Trinucleotides analysis}



laml.tnm = trinucleotideMatrix(maf = maf_file, prefix = 'chr', add = TRUE, ref_genome = "BSgenome.Hsapiens.UCSC.hg19")

plotApobecDiff(tnm = laml.tnm, maf = maf_file, pVal = 0.2)

```

<br><br>

**🔹ما هو APOBEC؟**

APOBEC = اختصار لـ Apolipoprotein B mRNA Editing Catalytic Polypeptide-like.

هي عائلة من الإنزيمات في الجسم وظيفتها الطبيعية: مكافحة الفيروسات عبر إدخال طفرات في DNA الفيروس.

لكن أحيانًا، هذه الإنزيمات تخطئ وتبدأ بإحداث طفرات في DNA الخلايا البشرية نفسها.

✴️ النمط المميز لطفرات APOBEC:

غالبًا تكون C>T أو C>G.

وتحدث في سياق tCw (أي C في وسط ثلاثية TCA أو TCT).


**🔹ما الهدف من تحليل APOBEC في السرطان؟**

تحديد إذا كان الورم غني بـ APOBEC activity (APOBEC-enriched):

يعني أن جزءًا كبيرًا من طفراته ناتج عن نشاط هذه الإنزيمات.

مقارنة APOBEC vs non-APOBEC samples (plotApobecDiff):

نعرف هل هناك فرق في عبء الطفرات (mutation load).

نعرف أي جينات تتأثر أكثر في العينات الغنية بـ APOBEC (مثل PIK3CA).

تفسير البصمة الجينية:

إذا وجدنا أن معظم الطفرات من نوع APOBEC → نستنتج أن هذا الإنزيم ساهم في تطور الورم.

أهمية سريرية:

الأورام ذات الطفرات الناتجة عن APOBEC أحيانًا تكون أكثر متحولة (hypermutated).

هذا قد يجعلها أكثر استجابة لعلاجات مناعية مثل Immune checkpoint inhibitors.

<br><br>


### 11.2 🔢 Estimate Optimal Number of Signatures
نستخدم NMF لتوقع العدد المناسب من البصمات.

```{r estimateSignatures}

laml.sign = estimateSignatures(mat = laml.tnm, nTry = 6)

plotCophenetic(res = laml.sign)

```

<br><br>

### 11.3 ✂️ Extract NMF signatures for chosen K
نقوم الآن باستخراج البصمات.

```{r extract signature}

NMF::nmf.options("verbose" = 0)
laml.sig = maftools::extractSignatures(mat = laml.tnm, n = 3,  parallel = 1)


```

<br><br>


### 11.4 🔍 Compare against COSMIC reference signatures

**🔹 ما هي COSMIC؟**

COSMIC هو اختصار لـ:
Catalogue Of Somatic Mutations In Cancer

📌 وهو أكبر قاعدة بيانات عالمية متخصصة في:

الطفرات الجسدية (Somatic mutations) المكتشفة في السرطان.

أنشئ في معهد سانغر (Sanger Institute – UK).

**🔹 محتوى COSMIC**

بيانات من آلاف الأورام البشرية.

يشمل أنواع مختلفة من الطفرات:

Single Nucleotide Variants (SNVs) (مثل C>T).

Insertions & Deletions (InDels).

Copy Number Variations (CNVs).

Fusions/Translocations.

أيضًا يحتوي على Mutational Signatures (بصمات الطفرات) التي طورها Alexandrov وآخرون.


**🔹 أهمية COSMIC**

مرجع عالمي:
أي طفرة تُكتشف في السرطان يمكن مقارنتها ببيانات COSMIC لمعرفة:

هل هي معروفة مسبقًا؟

هل تعتبر طفرة "driver" (مسببة للسرطان) أم "passenger" (طفرة عشوائية)؟

تحليل البصمات الطفرية:

COSMIC صنف عشرات البصمات الطفرية (Mutational Signatures, SBS, DBS, ID signatures).

كل بصمة مرتبطة بآلية معينة (مثل التدخين، الأشعة فوق البنفسجية، APOBEC، خلل إصلاح DNA … إلخ).

أداة للبحث العلمي والسريري:

يستخدمها الباحثون لتفسير بيانات NGS.

الأطباء يمكن أن يستفيدوا منها لتحديد الأهداف العلاجية (Therapeutic targets).




```{r compare signature}

laml.v3.cosm = compareSignatures(nmfRes = laml.sig, sig_db = "SBS")


```

<br><br>

### 11.5 ♨️ Heatmap: cosine similarity to validated signatures

نُقارن بالبصمات الوراثية التي لدينا بالبصمات المسجلة في قاعدة بيانات COSMIC
باستخدام طريقة احصائية تسمى: cosine similarity.

```{r heatmap signature}

library('pheatmap')

pheatmap::pheatmap(mat = laml.v3.cosm$cosine_similarities, cluster_rows = FALSE, main = "cosine similarity against validated signatures")

```

<br><br>

### 11.6  Plot extracted signatures (SBS labels)

هذا الرسم هو الخطوة النهائية في تحليل الـ mutational signatures:

يوضح أنماط الطفرات (96-contexts).

يربطها بأشهر البصمات العالمية (SBS signatures).

يساعد في تفسير الطفرات من منظور بيولوجي وسريري.


```{r plot signature}

maftools::plotSignatures(nmfRes = laml.sig, title_size = 1.2, sig_db = "SBS")

```


**🔹 شرح النتائج المعروضة:**

**📌 Signature 1 → SBS2**
Cosine similarity: 0.767

Aetiology: نشاط إنزيم APOBEC (Cytidine Deaminase) الذي يحول C إلى T (وأحيانًا C إلى G).

النمط المميز: ارتفاع في طفرات C>T في سياق TCN (tCw).

الأهمية:

شائع في سرطانات الثدي والرئة وعنق الرحم.

مرتبط بزيادة الحمل الطفري (hypermutation).


**📌 Signature 2 → SBS6**
Cosine similarity: 0.834

Aetiology: خلل في DNA mismatch repair (MMR defect).

النمط المميز: انتشار طفرات متنوعة خاصة في C>T و C>A.

الأهمية:

موجود في سرطانات القولون والمستقيم (microsatellite instability – MSI).

سريريًا: الأورام ذات MMR-deficiency غالبًا تستجيب بشكل جيد للعلاج المناعي (immune checkpoint inhibitors).


**📌 Signature 3 → SBS10b**
Cosine similarity: 0.883

Aetiology: طفرات في Polymerase epsilon (POLE) exonuclease domain.

النمط المميز: نسبة عالية جدًا من C>T (وخاصة في سياقات معينة).

الأهمية:

الأورام ذات طفرات POLE عادة تكون hypermutated.

يمكن أن تكون أكثر مناعة (high neoantigen load) وبالتالي مرشحة للعلاج المناعي.

🔹 الاستنتاج:

في هذه البيانات، تم تحديد 3 بصمات رئيسية للطفرات:

APOBEC (SBS2) → إنزيم يسبب C>T.

MMR defect (SBS6) → خلل إصلاح DNA.

POLE mutations (SBS10b) → عطب في إنزيم البوليميراز.

➡️ هذه النتائج تعكس أن الورم المدروس نشأ من تعدد آليات طفرية مختلفة (enzyme-induced, repair-defect, polymerase-defect).

___
___

#ختاما

## 🔬 في هذا التحليل باستخدام maftools:

1. بدأنا بـ قراءة بيانات الطفرات (MAF file) واستكشاف أهم الجينات المتأثرة (oncoplot).

2. حللنا أنماط الطفرات الأساسية (Transition/Transversion, VAF distribution).

3. درسنا العلاقات بين الجينات المتحورة (co-occurrence vs mutual exclusivity).

4. قيّمنا تغايرية الورم (Tumor heterogeneity) باستخدام VAF clustering و MATH score.

5. أجرينا تحليل Mutational Signatures:

5.1 استخراج البصمات الطفرية بالـ NMF.

5.2 تحديد العدد الأمثل للبصمات (cophenetic metric).

5.3 مقارنة البصمات المستخرجة مع COSMIC signatures (v2 و v3).

5.4 تفسير أهم البصمات (APOBEC, MMR defect, POLE mutations).

## **📌 الخلاصة:**
هذا التحليل مكّنّا من رسم صورة شاملة عن المشهد الجينومي للورم، بدءًا من الطفرات الفردية إلى البصمات الطفرية الكاملة، مع تفسير بيولوجي وسريري محتمل.
هذه المعلومات أساسية لفهم آليات نشوء الورم (tumorigenesis) وتحديد أهداف علاجية محتملة (مثل الأورام ذات MMR-deficiency أو POLE mutations التي تستجيب للعلاج المناعي).

___
___

✨ بهذا نكون قد أنهينا الـ workflow التحليلي باستخدام maftools.




















